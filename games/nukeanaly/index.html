<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nuke Analy - O Jogo</title>
    <link rel="icon" href="../favicom.png" type="image/x-icon">
    <style>
        body {
            margin: 0;
            overflow: hidden; /* Garante que não haverá barras de rolagem indesejadas */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh; /* Ocupa a altura total da viewport */
            background-color: #000; /* Fundo preto para jogos */
            color: #fff;
            font-family: Arial, sans-serif;
        }

        /* Estilos para o canvas ou container do jogo, se for usado */
        #game-container {
            width: 100%;
            height: 100vh; /* Ocupa a altura total da viewport */
            display: flex;
            justify-content: center;
            align-items: center;
            /* Se o seu jogo for um canvas, ele pode ir aqui */
        }

        /* Estilos básicos para o menu de pausa/opções se você tiver um */
        #pause-menu {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 8px;
            display: none; /* Inicia oculto */
            z-index: 1000;
            text-align: center;
        }
        #pause-menu button {
            display: block;
            width: 150px;
            padding: 10px;
            margin: 10px auto;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
        }
        #pause-menu button:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <canvas id="nukeAnalyCanvas" width="800" height="600" style="border: 1px solid #333; background-color: #111;"></canvas>

        <p>Carregando Nuke Analy...</p>
    </div>

    <div id="pause-menu">
        <h2>Jogo Pausado</h2>
        <button id="resume-button">Continuar Jogo</button>
        <button id="settings-button">Configurações do Jogo</button>
        <button id="exit-button">Sair do Jogo</button>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js';
        import { getFirestore, doc, getDoc, setDoc } from 'https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js';
        import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/9.0.0/firebase-auth.js';

        // --- Configuração do Firebase ---
        const firebaseConfig = {
            apiKey: "AIzaSyB9GkSqTIZ0kbVsba_WOdQeVAETrF9qna0",
            authDomain: "wzzm-ce3fc.firebaseapp.com",
            projectId: "wzzm-ce3fc",
            storageBucket: "wzzm-ce3fc.appspot.com",
            messagingSenderId: "249427877153",
            appId: "1:249427877153:web:0e4297294794a5aadeb260",
            measurementId: "G-PLKNZNFCQ8"
        };

        const app = initializeApp(firebaseConfig);
        const firestore = getFirestore(app);
        const auth = getAuth(app);

        let currentUser = null;
        let gameSettings = {}; // Configurações do jogo para este usuário
        let isGamePaused = false;
        const pauseMenu = document.getElementById('pause-menu');

        // Função para carregar as configurações do jogo do usuário
        async function loadGameSettings(userId) {
            const settingsRef = doc(firestore, 'users', userId, 'configuracoes', 'jogo');
            try {
                const docSnap = await getDoc(settingsRef);
                if (docSnap.exists()) {
                    gameSettings = docSnap.data();
                    console.log("Configurações do jogo carregadas:", gameSettings);
                    // Aqui você pode aplicar as configurações ao seu jogo
                    // Ex: se o jogo tiver uma função `setVolume(volume)`
                    // if (gameSettings.volume !== undefined && typeof window.setVolume === 'function') {
                    //     window.setVolume(gameSettings.volume);
                    // }
                    // if (gameSettings.difficulty !== undefined && typeof window.setDifficulty === 'function') {
                    //     window.setDifficulty(gameSettings.difficulty);
                    // }
                    // E assim por diante para outras configurações.
                } else {
                    console.log("Nenhuma configuração de jogo encontrada para o usuário, usando padrões.");
                    // Defina configurações padrão se não existirem
                    gameSettings = {
                        onlineMode: true,
                        volume: 0.7,
                        difficulty: 'normal',
                        primaryColor: '#3f51b5',
                        accentColor: '#ff4081'
                    };
                    // Você pode optar por salvar essas configurações padrão imediatamente
                    // await setDoc(settingsRef, gameSettings);
                }
            } catch (error) {
                console.error("Erro ao carregar configurações do jogo:", error);
                // Fallback para configurações padrão em caso de erro
                gameSettings = { onlineMode: true, volume: 0.7, difficulty: 'normal', primaryColor: '#3f51b5', accentColor: '#ff4081' };
            }
            return gameSettings;
        }

        // Função para pausar o jogo (exemplo)
        function pauseGame() {
            isGamePaused = true;
            // Aqui você deve adicionar a lógica para pausar seu jogo real
            // Ex: parar loops de animação, desativar inputs, etc.
            pauseMenu.style.display = 'block';
            console.log("Jogo Pausado!");
        }

        // Função para resumir o jogo (exemplo)
        function resumeGame() {
            isGamePaused = false;
            // Aqui você deve adicionar a lógica para resumir seu jogo real
            pauseMenu.style.display = 'none';
            console.log("Jogo Resumido!");
        }

        // Listener para o estado de autenticação
        onAuthStateChanged(auth, async (user) => {
            currentUser = user;
            if (currentUser) {
                console.log("Usuário logado:", currentUser.uid);
                await loadGameSettings(currentUser.uid);
            } else {
                console.log("Usuário não logado. Usando configurações padrão do jogo.");
                gameSettings = { onlineMode: true, volume: 0.7, difficulty: 'normal', primaryColor: '#3f51b5', accentColor: '#ff4081' };
            }
            // Inicia o jogo ou carrega recursos após as configurações
            // iniciarNukeAnaly(gameSettings); // Chame a função que inicializa seu jogo real
        });

        // Simulação de jogo simples (remova isso e adicione seu jogo real)
        const canvas = document.getElementById('nukeAnalyCanvas');
        const ctx = canvas.getContext('2d');
        let gameLoopId;

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = 'blue';
            ctx.fillRect(50, 50, 100, 100);
            ctx.fillStyle = 'white';
            ctx.font = '20px Arial';
            ctx.fillText("Nuke Analy Rodando!", 280, 300);
            if (!isGamePaused) {
                gameLoopId = requestAnimationFrame(draw);
            }
        }
        // Inicia a simulação
        gameLoopId = requestAnimationFrame(draw);

        // Lógica para pausar/retomar com 'Esc' (exemplo)
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                if (isGamePaused) {
                    resumeGame();
                } else {
                    pauseGame();
                }
            }
        });

        // Listeners para os botões do menu de pausa
        document.getElementById('resume-button').addEventListener('click', resumeGame);
        document.getElementById('settings-button').addEventListener('click', () => {
            // Abre a página de configurações em uma nova aba
            window.open('./configuracoes.html', '_blank');
        });
        document.getElementById('exit-button').addEventListener('click', () => {
            // Volta para a página de listagem de jogos
            window.close(); // Tenta fechar a aba atual
            // Ou redireciona a janela pai, se estiver em um iframe
            // window.parent.location.href = '../games/index.html';
        });

        // Exemplo de como o jogo pode salvar um dado simples no Firestore (ex: high score)
        async function saveHighScore(score) {
            if (currentUser) {
                const userDocRef = doc(firestore, 'users', currentUser.uid);
                await setDoc(userDocRef, { nukeAnalyHighScore: score }, { merge: true });
                console.log("High score salvo:", score);
            }
        }

        // saveHighScore(12345); // Exemplo de uso dentro do seu jogo
    </script>
</body>
</html>
