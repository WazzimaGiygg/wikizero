<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fórum Wiki Zone</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css">
    </head>
<body>
   <script>
    // Inicialize Firebase (mesma configuração do index.html)
    const firebaseConfig = {
        apiKey: "AIzaSyB9GkSqTIZ0kbVsba_WOdQeVAETrF9qna0",
        authDomain: "wzzm-ce3fc.firebaseapp.com",
        projectId: "wzzm-ce3fc",
        storageBucket: "wzzm-ce3fc.appspot.com",
        messagingSenderId: "249427877153",
        appId: "1:249427877153:web:0e4297294794a5aadeb260",
        measurementId: "G-PLKNZNFCQ8"
    };

    if (!firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
    }
    const firestore = firebase.firestore();
    const auth = firebase.auth(); // Pode ser útil para confirmar o usuário no fórum

    const urlParams = new URLSearchParams(window.location.search);
    const userUid = urlParams.get('uid');

    // Referências aos elementos do formulário (você precisará adicioná-los ao seu HTML)
    const subjectInput = document.getElementById('subjectInput');
    const contentInput = document.getElementById('contentInput');
    const submitButton = document.getElementById('submitButton');
    const messageList = document.getElementById('messageList'); // Elemento onde as mensagens serão listadas

    if (!userUid) {
        alert("Erro: UID do usuário não fornecido. Por favor, faça login novamente.");
        // Opcional: Redirecionar de volta para index.html
        // window.top.location.href = 'index.html';
    }

    submitButton.addEventListener('click', async () => {
        const subject = subjectInput.value;
        const content = contentInput.value;

        if (!subject || !content) {
            alert("Por favor, preencha o assunto e o conteúdo da mensagem.");
            return;
        }

        try {
            // Adiciona um novo documento à coleção 'forum_posts'
            // O Firestore irá gerar um ID automático para este documento
            await firestore.collection('forum_posts').add({
                subject: subject,
                content: content,
                authorUid: userUid, // O UID do Google do usuário logado
                timestamp: firebase.firestore.FieldValue.serverTimestamp() // Carimbo de data/hora do servidor
            });

            alert("Mensagem enviada com sucesso!");
            subjectInput.value = ''; // Limpa os campos
            contentInput.value = '';
            fetchMessages(); // Recarrega a lista de mensagens
        } catch (error) {
            console.error("Erro ao enviar mensagem para o Firestore:", error);
            alert("Ocorreu um erro ao enviar sua mensagem. Tente novamente.");
        }
    });

    // Função para buscar e exibir mensagens
    async function fetchMessages() {
        try {
            // Ordena as mensagens pela data/hora em ordem decrescente (mais recentes primeiro)
            const snapshot = await firestore.collection('forum_posts')
                                            .orderBy('timestamp', 'desc')
                                            .get();
            messageList.innerHTML = ''; // Limpa a lista existente

            if (snapshot.empty) {
                messageList.innerHTML = '<p>Nenhuma mensagem ainda. Seja o primeiro a postar!</p>';
                return;
            }

            snapshot.forEach(doc => {
                const data = doc.data();
                const messageElement = document.createElement('div');
                messageElement.classList.add('forum-post'); // Adicione uma classe para estilização

                // Formatar o timestamp para ser mais legível
                const date = data.timestamp ? new Date(data.timestamp.toDate()) : new Date();
                const formattedDate = date.toLocaleString('pt-BR');

                messageElement.innerHTML = `
                    <h3><span class="math-inline">\{data\.subject\}</h3\>

    <div id="forum-content" class="page-content">
        </div>

    </body>
</html>
