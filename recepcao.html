<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fórum Wiki Zone</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
</head>
<body>
    <script>
        // Configuração Firebase
        const firebaseConfig = {
            apiKey: "sua-api-key",
            authDomain: "seu-auth-domain",
            projectId: "seu-project-id",
            storageBucket: "seu-storage-bucket",
            messagingSenderId: "seu-sender-id",
            appId: "seu-app-id",
            measurementId: "seu-measurement-id"
        };

        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }

        const auth = firebase.auth();
        const firestore = firebase.firestore();

        // Função para fazer login com Google
        function googleLogin() {
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider).then(result => {
                // O UID do usuário logado
                const user = result.user;
                console.log("Usuário logado:", user.displayName);
                console.log("UID do usuário:", user.uid);

                // Redirecionar para o fórum após o login
                window.location.href = 'forum.html'; // Altere para a página do fórum
            }).catch(error => {
                console.error("Erro no login com Google:", error);
            });
        }

        // Função para verificar se o usuário está logado
        function checkUserStatus() {
            const user = auth.currentUser;
            if (user) {
                // Exibir o conteúdo do fórum
                loadForumContent(user.uid); // Passa o UID do usuário autenticado
            } else {
                // Usuário não logado, redireciona para o login
                alert("Você precisa estar logado para acessar o fórum!");
                window.location.href = 'login.html'; // Página de login
            }
        }

        // Função para carregar os tópicos do fórum
        function loadForumContent(uid) {
            fetch('https://api.exemplo.com/forum', {
                method: 'GET',
                headers: {
                    'X-Access-Key': '$2a$10$yYkleiX8VSZNdbcsN8o6iuVm56ZSSHYExMh.OZ8DW07Qx5B1OJpj6',
                    'X-master-key': '$2a$10$cEA4Da43tn/93eVxBkR.AufLM/ALUPxOgh8KskR1QvSLsUHzLyb4y'
                }
            })
            .then(response => response.json())
            .then(data => {
                displayForum(data, uid); // Passando o UID para associar com os tópicos
            })
            .catch(error => console.error('Erro ao carregar os tópicos do fórum:', error));
        }

        // Função para exibir os tópicos do fórum
        function displayForum(data, uid) {
            const forumContainer = document.getElementById('forum-content');
            forumContainer.innerHTML = ''; // Limpar conteúdo existente
            data.topics.forEach(topic => {
                const topicElement = document.createElement('div');
                topicElement.classList.add('forum-topic');
                topicElement.innerHTML = `
                    <h3>${topic.title}</h3>
                    <p>${topic.content}</p>
                    <small>Criado por: ${topic.author}</small>
                `;
                forumContainer.appendChild(topicElement);

                // Verificando se o tópico foi criado pelo usuário logado
                if (topic.authorUID === uid) {
                    const editButton = document.createElement('button');
                    editButton.innerText = 'Editar';
                    editButton.addEventListener('click', () => editTopic(topic.id));
                    topicElement.appendChild(editButton);
                }
            });
        }

        // Função para editar o tópico (apenas se o UID corresponder)
        function editTopic(topicId) {
            alert('Abrir formulário de edição para o tópico ' + topicId);
            // Implemente a lógica de edição aqui
        }

        // Chama a função para verificar o status do usuário ao carregar a página
        window.onload = function() {
            checkUserStatus();
        };
    </script>

    <!-- Conteúdo da página -->
    <div id="forum-content" class="page-content">
        <!-- Os tópicos do fórum serão carregados aqui -->
    </div>

    <!-- Botão de login Google -->
    <button onclick="googleLogin()">Login com Google</button>
</body>
</html>
